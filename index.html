<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>服务状态监控</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <style>
    /* ... (所有CSS样式保持不变) ... */
    .nas-stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 25px;}
    .nas-stat-card { background: #fff; border-radius: 16px; padding: 25px; box-shadow: 0 6px 20px rgba(0,0,0,0.07); }
    /* ... (其他CSS) ... */
  </style>
</head>
<body>
  <div class="container">
    <header><!-- ... header ... --></header>
    <div class="status-summary"><!-- ... summary cards ... --></div>
    
    <div class="nas-section" id="nas-section-container" style="display: none;">
      <h2 class="section-title"><i class="fas fa-server"></i><span>NAS 系统状态</span></h2>
      <!-- 进度条区域 -->
      <div class="nas-stats-grid" id="nas-realtime-stats"></div>
      <!-- 历史图表区域 -->
      <div class="charts-grid">
        <div class="chart-container"><div class="chart-header"><h3 class="chart-title">CPU 使用率 (近7日)</h3></div><div class="nas-chart-wrapper"><canvas id="nasCpuHistoryChart"></canvas></div></div>
        <div class="chart-container"><div class="chart-header"><h3 class="chart-title">网络流量增长 (近7日)</h3></div><div class="nas-chart-wrapper"><canvas id="nasNetworkHistoryChart"></canvas></div></div>
      </div>
    </div>

    <div class="services-grid"><!-- ... UptimeRobot services list ... --></div>
    <div class="charts-section"><!-- ... overview charts ... --></div>
    <footer><!-- ... footer ... --></footer>
  </div>
  
  <script>
    const PROXY_API_URL = 'https://up-api.111312.xyz/';
    let nasCpuHistoryChart, nasNetworkHistoryChart;

    function renderPage(data) {
        if (data) {
            if (data.monitors) { /* ... */ }
            if (data.nas_stats) {
                document.getElementById('nas-section-container').style.display = 'block';
                renderNasProgressBars(data.nas_stats);
            }
            if (data.nas_history) {
                renderNasHistoryCharts(data.nas_history);
            }
        }
    }
    
    // --- 新增：渲染NAS的进度条 ---
    function renderNasProgressBars(stats) {
        const container = document.getElementById('nas-realtime-stats');
        let html = '';
        const items = [
            { icon: 'fa-microchip', label: 'CPU', data: stats.cpu },
            { icon: 'fa-memory', label: '内存', data: stats.memory },
            { icon: 'fa-compact-disc', label: '磁盘', data: stats.disk }
        ];
        items.forEach(item => {
            if(item.data){
                 html += `<div class="nas-stat-card">
                    <div class="progress-bar-info"><span class="progress-bar-label"><i class="fas ${item.icon}"></i> ${item.label}</span><span>${item.data.percent}%</span></div>
                    <div class="progress-bar-bg"><div class="progress-bar-fill" style="width: ${item.data.percent}%;"></div></div>
                 </div>`;
            }
        });
        container.innerHTML = html;
    }

    // --- 新增：渲染NAS的历史图表 ---
    function renderNasHistoryCharts(history) {
        if (nasCpuHistoryChart) nasCpuHistoryChart.destroy();
        if (nasNetworkHistoryChart) nasNetworkHistoryChart.destroy();

        // CPU 历史图表
        const cpuCtx = document.getElementById('nasCpuHistoryChart')?.getContext('2d');
        if (cpuCtx && history.cpu) {
            nasCpuHistoryChart = new Chart(cpuCtx, {
                type: 'line', data: { datasets: [{
                    label: 'CPU Usage (%)', data: history.cpu.map(d => ({x: d.timestamp * 1000, y: d.usage})),
                    borderColor: 'rgba(30, 136, 229, 0.7)', borderWidth: 2, pointRadius: 0, tension: 0.4
                }]},
                options: { responsive: true, maintainAspectRatio: false, scales: { x: { type: 'time', time: { unit: 'day' } } } }
            });
        }
        
        // 网络历史图表
        const netCtx = document.getElementById('nasNetworkHistoryChart')?.getContext('2d');
        if (netCtx && history.network) {
            const datasets = [
                { iface: 'eth0', recv: 'eth0_recv', sent: 'eth0_sent', color: 'rgba(76, 175, 80, 0.7)'},
                { iface: 'wlan0', recv: 'wlan0_recv', sent: 'wlan0_sent', color: 'rgba(255, 152, 0, 0.7)'},
                { iface: 'docker0', recv: 'docker0_recv', sent: 'docker0_sent', color: 'rgba(156, 39, 176, 0.7)'}
            ].map(config => ({
                label: `${config.iface} 总流量 (GB)`,
                data: history.network.map(d => ({ x: d.timestamp * 1000, y: ((d[config.recv] || 0) + (d[config.sent] || 0)) / 1024**3 })),
                borderColor: config.color, borderWidth: 2, pointRadius: 0, tension: 0.4
            }));

            nasNetworkHistoryChart = new Chart(netCtx, {
                type: 'line', data: { datasets: datasets },
                options: { responsive: true, maintainAspectRatio: false, scales: { x: { type: 'time', time: { unit: 'day' } }, y: { title: { display: true, text: 'GB' } } } }
            });
        }
    }
    
    // ... 其他所有JS函数保持不变 ...
  </script>
</body>
</html>
