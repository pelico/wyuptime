<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UptimeRobot 监控状态</title>
    <style>
        :root {
            --color-bg: #121212;
            --color-card: #1e1e1e;
            --color-text: #e0e0e0;
            --color-text-secondary: #a0a0a0;
            --color-border: #333;
            --color-up: #2ecc71;
            --color-down: #e74c3c;
            --color-paused: #f39c12;
            --color-seems-down: #e67e22;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        .container {
            width: 100%;
            max-width: 800px;
        }
        h1 {
            text-align: center;
            color: white;
            border-bottom: 2px solid var(--color-border);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        #loading {
            text-align: center;
            font-size: 1.2em;
            color: var(--color-text-secondary);
        }
        .monitor-list {
            display: grid;
            gap: 15px;
        }
        .monitor-item {
            background-color: var(--color-card);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background-color 0.3s ease;
        }
        .monitor-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .status-up { background-color: var(--color-up); }
        .status-down { background-color: var(--color-down); }
        .status-paused { background-color: var(--color-paused); }
        .status-seems-down { background-color: var(--color-seems-down); }
        .monitor-details {
            display: flex;
            flex-direction: column;
        }
        .monitor-name {
            font-size: 1.1em;
            font-weight: bold;
            color: var(--color-text);
        }
        .monitor-url {
            font-size: 0.9em;
            color: var(--color-text-secondary);
            word-break: break-all;
        }
        .monitor-status {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
            text-align: center;
            min-width: 60px;
        }
        .status-label-up { color: var(--color-up); border: 1px solid var(--color-up); }
        .status-label-down { color: var(--color-down); border: 1px solid var(--color-down); }
        .status-label-paused { color: var(--color-paused); border: 1px solid var(--color-paused); }
        .status-label-seems-down { color: var(--color-seems-down); border: 1px solid var(--color-seems-down); }
        
        footer {
            text-align: center;
            margin-top: 30px;
            font-size: 0.8em;
            color: var(--color-text-secondary);
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>UptimeRobot 监控状态</h1>
        <div id="loading">正在加载数据...</div>
        <div id="monitor-list" class="monitor-list"></div>
        <footer id="footer"></footer>
    </div>

    <script>
        // --- 配置 ---
        // !!! 将这里的 URL 替换为您在 Cloudflare 上创建的 Worker 的 URL !!!
        const proxyApiUrl = 'https://uptime.pelico.workers.dev';
        const refreshInterval = 5 * 60 * 1000; // 5分钟

        // --- DOM 元素 ---
        const loadingElement = document.getElementById('loading');
        const listElement = document.getElementById('monitor-list');
        const footerElement = document.getElementById('footer');
        
        // --- 核心函数 ---
        function getStatusInfo(status) {
            switch (status) {
                case 0: return { text: '暂停中', className: 'status-paused', labelClassName: 'status-label-paused' };
                case 1: return { text: '未检测', className: 'status-paused', labelClassName: 'status-label-paused' };
                case 2: return { text: '正常', className: 'status-up', labelClassName: 'status-label-up' };
                case 8: return { text: '疑似故障', className: 'status-seems-down', labelClassName: 'status-label-seems-down' };
                case 9: return { text: '故障', className: 'status-down', labelClassName: 'status-label-down' };
                default: return { text: '未知', className: 'status-paused', labelClassName: 'status-label-paused' };
            }
        }

        async function fetchAndDisplayMonitors() {
            // 检查用户是否已替换代理URL
            if (proxyApiUrl.includes('your-worker-name')) {
                loadingElement.textContent = '错误：请在HTML代码中替换为您的Cloudflare Worker URL！';
                loadingElement.style.color = 'red';
                return;
            }

            loadingElement.style.display = 'block';
            listElement.innerHTML = '';

            try {
                // 现在我们请求自己的代理，而不是UptimeRobot
                const response = await fetch(proxyApiUrl, {
                    method: 'POST', // 代理需要POST请求
                    headers: { 'Content-Type': 'application/json' }
                });

                if (!response.ok) {
                    throw new Error(`网络错误: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();

                if (data.stat === 'fail') {
                    throw new Error(`API 错误: ${data.error.message}`);
                }

                displayMonitors(data.monitors);
                updateFooter();

            } catch (error) {
                listElement.innerHTML = `<div class="monitor-item"><p>数据加载失败: ${error.message}</p></div>`;
            } finally {
                loadingElement.style.display = 'none';
            }
        }

        function displayMonitors(monitors) {
            if (!monitors || monitors.length === 0) {
                listElement.innerHTML = `<div class="monitor-item"><p>没有找到任何监控项。</p></div>`;
                return;
            }

            monitors.sort((a, b) => {
                const order = { 9: 0, 8: 1, 0: 2, 1: 2, 2: 3 };
                return (order[a.status] || 99) - (order[b.status] || 99);
            });

            monitors.forEach(monitor => {
                if (monitor.type !== 1 && monitor.type !== 2) return;
                
                const statusInfo = getStatusInfo(monitor.status);
                const itemHTML = `
                    <div class="monitor-item">
                        <div class="monitor-info">
                            <div class="status-indicator ${statusInfo.className}"></div>
                            <div class="monitor-details">
                                <div class="monitor-name">${monitor.friendly_name}</div>
                                <div class="monitor-url">${monitor.url}</div>
                            </div>
                        </div>
                        <div class="monitor-status ${statusInfo.labelClassName}">
                            ${statusInfo.text}
                        </div>
                    </div>
                `;
                listElement.insertAdjacentHTML('beforeend', itemHTML);
            });
        }
        
        function updateFooter() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-CN', { hour12: false });
            footerElement.textContent = `最后更新于: ${timeString}`;
        }

        // --- 启动 ---
        document.addEventListener('DOMContentLoaded', () => {
            fetchAndDisplayMonitors();
            setInterval(fetchAndDisplayMonitors, refreshInterval);
        });
    </script>
</body>
</html>
